<!DOCTYPE html>
<html lang="en" data-bs-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ultimate Expense Pro</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/luxon@3.4.4/build/global/luxon.min.js"></script>
  <style>
    :root {
      --primary: #2c3e50;
      --secondary: #3498db;
      --success: #27ae60;
      --danger: #e74c3c;
      --warning: #f1c40f;
    }

    .currency::before {
      content: "৳";
      margin-right: 4px;
      color: var(--secondary);
    }

    .budget-progress {
      height: 25px;
      border-radius: 20px;
    }

    .receipt-preview {
      max-width: 120px;
      cursor: zoom-in;
      transition: transform 0.3s;
    }

    .receipt-preview:hover {
      transform: scale(1.8);
      z-index: 1000;
    }

    .analytics-card {
      background: linear-gradient(135deg, var(--primary), var(--secondary));
      color: white;
      border-radius: 15px;
      padding: 1.5rem;
    }
  </style>
</head>
<body class="container-fluid py-4">
  <!-- Toast Container -->
  <div class="toast-container position-fixed bottom-0 end-0 p-3"></div>

  <!-- Header -->
  <header class="d-flex justify-content-between align-items-center mb-4">
    <div>
      <h1 class="h2 fw-bold text-primary">
        <i class="bi bi-cash-stack"></i> Expense Pro
      </h1>
      <div class="d-flex gap-2 align-items-center">
        <select class="form-select" id="currencySelector">
          <option value="BDT">BDT (৳)</option>
          <option value="USD">USD ($)</option>
          <option value="EUR">EUR (€)</option>
        </select>
        <button class="btn btn-sm btn-outline-primary" id="themeToggle">
          <i class="bi bi-moon-stars"></i>
        </button>
      </div>
    </div>
    
    <div class="d-flex gap-2">
      <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#reportModal">
        <i class="bi bi-graph-up"></i> Reports
      </button>
      <button class="btn btn-success" data-bs-toggle="modal" data-bs-target="#budgetModal">
        <i class="bi bi-piggy-bank"></i> Budgets
      </button>
    </div>
  </header>

  <!-- Main Grid -->
  <div class="row g-4">
    <!-- Input Section -->
    <div class="col-lg-3">
      <div class="card shadow">
        <div class="card-body">
          <form id="expenseForm" enctype="multipart/form-data">
            <input type="hidden" id="editId">
            
            <div class="mb-3">
              <label class="form-label">Date</label>
              <input type="date" class="form-control" id="date" required>
            </div>

            <div class="mb-3">
              <label class="form-label">Category</label>
              <select class="form-select" id="category" required>
                <option value="Food">Food</option>
                <option value="Transport">Transport</option>
                <option value="Housing">Housing</option>
                <option value="Entertainment">Entertainment</option>
                <option value="Healthcare">Healthcare</option>
              </select>
            </div>

            <div class="mb-3">
              <label class="form-label">Amount</label>
              <div class="input-group">
                <span class="input-group-text currency"></span>
                <input type="number" class="form-control" id="amount" step="0.01" required>
              </div>
            </div>

            <div class="mb-3">
              <label class="form-label">Receipt</label>
              <input type="file" class="form-control" id="receipt" accept="image/*">
              <img src="" class="receipt-preview mt-2 d-none" alt="Receipt Preview">
            </div>

            <div class="d-grid gap-2">
              <button type="submit" class="btn btn-primary">
                <i class="bi bi-save"></i> Save Expense
              </button>
            </div>
          </form>
        </div>
      </div>

      <!-- Budget Summary -->
      <div class="card mt-4 shadow">
        <div class="card-body">
          <h6 class="card-title mb-3"><i class="bi bi-speedometer2"></i> Budget Overview</h6>
          <div id="budgetSummary"></div>
        </div>
      </div>
    </div>

    <!-- Data Section -->
    <div class="col-lg-9">
      <div class="card shadow">
        <div class="card-body">
          <div class="d-flex justify-content-between mb-4">
            <div class="input-group w-50">
              <input type="text" class="form-control" placeholder="Search expenses..." id="searchInput">
              <button class="btn btn-outline-secondary" type="button">
                <i class="bi bi-search"></i>
              </button>
            </div>
            
            <div class="d-flex gap-2">
              <input type="date" class="form-control" id="startDate">
              <input type="date" class="form-control" id="endDate">
              <select class="form-select" id="categoryFilter">
                <option value="">All Categories</option>
              </select>
            </div>
          </div>

          <div class="table-responsive">
            <table class="table table-hover align-middle">
              <thead class="table-light">
                <tr>
                  <th>Date</th>
                  <th>Category</th>
                  <th>Amount</th>
                  <th>Receipt</th>
                  <th>Actions</th>
                </tr>
              </thead>
              <tbody id="expenseTable"></tbody>
            </table>
          </div>

          <div class="row mt-4">
            <div class="col-md-6">
              <div class="analytics-card">
                <h5><i class="bi bi-pie-chart"></i> Category Distribution</h5>
                <canvas id="categoryChart"></canvas>
              </div>
            </div>
            <div class="col-md-6">
              <div class="analytics-card mt-3 mt-md-0">
                <h5><i class="bi bi-bar-chart"></i> Monthly Trend</h5>
                <canvas id="trendChart"></canvas>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Modals -->
  <div class="modal fade" id="reportModal">
    <!-- Report Modal Content -->
  </div>

  <div class="modal fade" id="budgetModal">
    <!-- Budget Modal Content -->
  </div>

<script>
const ExpenseManager = {
  expenses: JSON.parse(localStorage.getItem('expenses')) || [],
  budgets: JSON.parse(localStorage.getItem('budgets')) || [],
  exchangeRates: { BDT: 1, USD: 0.0095, EUR: 0.0088 },
  currentCurrency: 'BDT',

  init() {
    this.setupEventListeners();
    this.renderAll();
    this.updateCurrency();
    this.fetchExchangeRates();
  },

  setupEventListeners() {
    document.getElementById('expenseForm').addEventListener('submit', e => this.saveExpense(e));
    document.getElementById('currencySelector').addEventListener('change', e => {
      this.currentCurrency = e.target.value;
      this.updateCurrency();
      this.renderAll();
    });
    document.getElementById('themeToggle').addEventListener('click', this.toggleTheme);
  },

  async fetchExchangeRates() {
    try {
      const response = await fetch('https://api.exchangerate-api.com/v4/latest/BDT');
      const data = await response.json();
      this.exchangeRates = data.rates;
    } catch (error) {
      console.error('Failed to fetch exchange rates:', error);
    }
  },

  updateCurrency() {
    document.querySelectorAll('.currency').forEach(el => {
      el.textContent = this.currentCurrency === 'BDT' ? '৳' : 
                      this.currentCurrency === 'USD' ? '$' : '€';
    });
  },

  convertAmount(amount) {
    return (amount * this.exchangeRates[this.currentCurrency]).toFixed(2);
  },

  saveExpense(e) {
    e.preventDefault();
    const formData = new FormData(e.target);
    
    const expense = {
      id: Date.now(),
      date: formData.get('date'),
      category: formData.get('category'),
      amount: parseFloat(formData.get('amount')),
      receipt: '',
      currency: this.currentCurrency,
      timestamp: new Date().toISOString()
    };

    const fileInput = document.getElementById('receipt');
    if (fileInput.files[0]) {
      const reader = new FileReader();
      reader.onload = (e) => {
        expense.receipt = e.target.result;
        this.expenses.push(expense);
        this.renderAll();
        this.showToast('Expense saved successfully!', 'success');
      };
      reader.readAsDataURL(fileInput.files[0]);
    } else {
      this.expenses.push(expense);
      this.renderAll();
      this.showToast('Expense saved successfully!', 'success');
    }

    e.target.reset();
  },

  renderAll() {
    this.renderTable();
    this.renderCharts();
    this.renderBudgetSummary();
    this.saveToLocalStorage();
  },

  renderTable() {
    const filtered = this.filterExpenses();
    const html = filtered.map(expense => `
      <tr>
        <td>${expense.date}</td>
        <td>
          <span class="badge rounded-pill bg-primary">${expense.category}</span>
        </td>
        <td class="currency">${this.convertAmount(expense.amount)}</td>
        <td>
          ${expense.receipt ? 
            `<img src="${expense.receipt}" class="receipt-preview" 
                 data-bs-toggle="modal" data-bs-target="#receiptModal">` : ''}
        </td>
        <td>
          <div class="dropdown">
            <button class="btn btn-sm" type="button" data-bs-toggle="dropdown">
              <i class="bi bi-three-dots-vertical"></i>
            </button>
            <ul class="dropdown-menu">
              <li><button class="dropdown-item" onclick="ExpenseManager.editExpense('${expense.id}')">
                <i class="bi bi-pencil"></i> Edit
              </button></li>
              <li><button class="dropdown-item text-danger" 
                onclick="ExpenseManager.deleteExpense('${expense.id}')">
                <i class="bi bi-trash"></i> Delete
              </button></li>
            </ul>
          </div>
        </td>
      </tr>
    `).join('');

    document.getElementById('expenseTable').innerHTML = html;
  },

  renderCharts() {
    // Category Distribution Pie Chart
    const categoryChart = new Chart(document.getElementById('categoryChart'), {
      type: 'pie',
      data: this.getChartData(),
      options: { responsive: true, maintainAspectRatio: false }
    });

    // Spending Trend Line Chart
    const trendChart = new Chart(document.getElementById('trendChart'), {
      type: 'line',
      data: this.getTrendData(),
      options: { responsive: true, maintainAspectRatio: false }
    });
  },

  renderBudgetSummary() {
    const budgetHtml = this.budgets.map(budget => `
      <div class="mb-3">
        <div class="d-flex justify-content-between mb-1">
          <span>${budget.category}</span>
          <span>${this.convertAmount(budget.spent)} / ${this.convertAmount(budget.limit)}</span>
        </div>
        <div class="progress budget-progress">
          <div class="progress-bar" role="progressbar" 
               style="width: ${(budget.spent/budget.limit)*100}%">
          </div>
        </div>
      </div>
    `).join('');
    document.getElementById('budgetSummary').innerHTML = budgetHtml;
  },

  // Additional methods for filtering, editing, deleting etc.
};

// Initialize the application
document.addEventListener('DOMContentLoaded', () => {
  ExpenseManager.init();
});
</script>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>