<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Online Expense Tracker</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    
    <!-- Firebase SDK (Latest Version) -->
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore-compat.js"></script>

    <style>
        .receipt-preview { max-width: 60px; cursor: pointer; transition: transform 0.3s; }
        .receipt-preview:hover { transform: scale(3); z-index: 1000; }
        .auth-container { max-width: 400px; margin: 50px auto; }
        .total-box { background: #e3f2fd; border-radius: 10px; padding: 15px; margin-top: 20px; }
    </style>
</head>
<body class="container py-4 bg-light">

<!-- Authentication Section -->
<div id="authContainer" class="auth-container">
    <div class="card shadow">
        <div class="card-body text-center">
            <h4 class="mb-4"><i class="bi bi-wallet2"></i> Expense Tracker</h4>
            <button class="btn btn-danger w-100 mb-2" onclick="googleLogin()">
                <i class="bi bi-google"></i> Continue with Google
            </button>
            <div id="errorMessage" class="text-danger mt-2"></div>
        </div>
    </div>
</div>

<!-- Main App Content (Same as Previous) -->

<script>
// Firebase Configuration
const firebaseConfig = {
    apiKey: "AIzaSyDjutN8p9j4XdAi_I_3-oWqiD1AbmdSdnM",
    authDomain: "online-data-6dcae.firebaseapp.com",
    projectId: "online-data-6dcae",
    storageBucket: "online-data-6dcae.firebasestorage.app",
    messagingSenderId: "848937873609",
    appId: "1:848937873609:web:51f1625a9ee7bf45bcdd18",
    measurementId: "G-41Q88XT5J5"
};

// Initialize Firebase
const app = firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

// Enhanced Google Login Handler
async function googleLogin() {
    try {
        const provider = new firebase.auth.GoogleAuthProvider();
        provider.addScope('profile');
        provider.addScope('email');
        
        const result = await auth.signInWithPopup(provider);
        console.log("Successfully logged in:", result.user);
        document.getElementById('errorMessage').textContent = '';
    } catch (error) {
        console.error("Login Error:", error);
        document.getElementById('errorMessage').textContent = `Login failed: ${error.message}`;
        
        // Handle specific errors
        if (error.code === 'auth/popup-closed-by-user') {
            alert('Login popup was closed before completing');
        }
        if (error.code === 'auth/network-request-failed') {
            alert('Network error. Please check your internet connection');
        }
    }
}

// Auth State Listener with Error Handling
auth.onAuthStateChanged(user => {
    try {
        const authContainer = document.getElementById('authContainer');
        const mainApp = document.getElementById('mainApp');

        if (user) {
            authContainer.style.display = 'none';
            mainApp.style.display = 'block';
            loadExpenses(user.uid);
        } else {
            authContainer.style.display = 'block';
            mainApp.style.display = 'none';
        }
    } catch (error) {
        console.error("Auth State Error:", error);
    }
});

// Rest of the code remains same as previous version
</script>

<!-- Rest of your code -->